!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=24)}([function(t,e){t.exports='<header class="head">\r\n  <h1 class="head__title">Wiskel</h1>\r\n  <div class="handle handle--head-handle">\r\n    <div class="handle__point"></div>\r\n  </div>\r\n</header>'},function(t,e){t.exports='<aside class="tools">\n  <div class="palette">\n    <div class="palette__tool palette__tool--pen" data-tool-type="pen" title="Pen"></div>\n    <div class="palette__tool palette__tool--eraser" data-tool-type="eraser" title="Eraser"></div>\n    <div class="palette__tool palette__tool--bucket" data-tool-type="bucket" title="Bucket"></div>\n    <div class="palette__tool palette__tool--rectangle" data-tool-type="rectangle" title="Rectangle&#13Kepp shift: 1 to 1 ratio"></div>\n    <div class="palette__tool palette__tool--paintsamecolor" data-tool-type="paintsamecolor" title="Paint all pixeles of the same color"></div>\n    <div class="palette__tool palette__tool--mirrorpen" data-tool-type="mirrorpen" title="Vertical Mirror Pen&#13Kepp ctrl for horizontal axis&#13Kepp shift for horizontal and vertical axis"></div>\n    <div class="palette__tool palette__tool--pipette" data-tool-type="pipette" title="Color Picker"></div>\n    <div class="palette__tool palette__tool--lighten" data-tool-type="lighten" title="Lighten"></div>\n    <div class="palette__tool palette__tool--dithering" data-tool-type="dithering" title="Dithering Tool"></div>\n    <div class="colorpicker-wrapper">\n      <input type="color" class="color-picker color-picker--main" data-tool-type="mainColorPicker">\n      <input type="color" class="color-picker color-picker--sub" data-tool-type="subColorPicker">\n      <div class="palette__tool palette__tool--swapcolors" data-tool-type="swapcolors" title="Swap Colors"></div>\n    </div>\n    <div class="palette__tool palette__tool--shortCuts" data-tool-type="shortCutsSetter" title="Keyboard Shortcuts"></div>\n  </div>\n</aside>'},function(t,e){t.exports='<article class="shortcuts">\n  <header class="shortcuts__title">\n    <span>Keyboard shortcuts</span>\n    <div class="shortcuts__close-btn">X</div>\n  </header>\n  <ul class="shortcuts__menu"></ul>\n  <footer class="shortcuts__footer">\n    <div class="btn shortcuts__restore-btn">Restore default shortcuts</div>\n  </footer>\n</article>'},function(t,e){t.exports='<div class="frames-wrapper">\r\n  <ul class="frames-wrapper__list"></ul>\r\n  <div class="btn frames-wrapper__btn">\r\n    <div class="frames-wrapper__btn-icon"></div>\r\n    <div>Add Frame</div>\r\n  </div>\r\n</div>'},function(t,e){t.exports='<div class="frame-wrapper">\n  <canvas class="frame"></canvas>\n  <div class="frame__tool frame__tool--counter"><i class="frame__tool-content">1</i></div>\n  <div class="frame__tool frame__tool--bucket"><i class="fas fa-trash-alt frame__tool-content"></i></div>\n  <div class="frame__tool frame__tool--dublicate"><i class="fas fa-copy frame__tool-content"></i></div>\n</div>'},function(t,e,n){t.exports=n.p+"img/ff229da200bda0d612e9ad5620765bec.png"},function(t,e){t.exports='<div class="main-canvas-wrapper">\r\n  <canvas class="main-canvas"></canvas>\r\n</div>'},function(t,e){t.exports='<div class="preview-wrapper">\n  <canvas></canvas>\n  <div class="range-wrapper">\n    <input type="range" min="1" max="24" step="1" value="0">\n    <span class="fps"></span>\n  </div>\n  <div class="btn preview__btn full-screen-btn">Full Screen Mode</div>\n  <div class="btn preview__btn get-gif-btn">Download as GIF</div>\n  <div class="btn preview__btn save-btn">Save</div>\n  <div class="btn preview__btn load-btn">Load</div>\n  <div class="btn preview__btn local-save-btn">Save to local file</div>\n  <div class="btn preview__btn local-load-btn">Load from local file</div>\n  <input class="file-input--hidden" type="file">\n  <div class="info">\n    <p class="info__coords">24 - 12</p>\n    <p class="info__size"></p>\n  </div>\n</div>'},function(t,e){t.exports='<main class="layout">\r\n  <div class="tools"></div>\r\n  <div class="frames"></div>\r\n  <div class="canvas"></div>\r\n  <div class="preview"></div>\r\n</main>'},function(t,e,n){t.exports=function(){return new Worker(n.p+"9504308241ab775ccabe.worker.js")}},function(t,e,n){t.exports='<section class="landing">\n  <article class="landing__screenshots">\n    <img class="landing__screnshot" src="'+n(20)+'" alt="">\n    <img class="landing__screnshot" src="'+n(21)+'" alt="">\n    <img class="landing__screnshot" src="'+n(22)+'" alt="">\n  </article>\n  <article class="landing__examples"></article>\n  <article class="landing__description">\n    <ul class="landing__features">\n      <li class="landing__feature">\n        <i class="fas fa-pen-fancy"></i>\n        Use Ctrl+Z / Ctrl+Y to undo/redo changes.\n      </li>\n      <li class="landing__feature">\n        <i class="fas fa-pen-fancy"></i>\n        Use Ctr + Space to swap active colors.\n      </li>\n      <li class="landing__feature">\n        <i class="fas fa-pen-fancy"></i>\n        Use Ctrl / Shift for tools modification, see tools tooltips for more information.\n      </li>\n      <li class="landing__feature">\n        <i class="fas fa-pen-fancy"></i>\n        Be creative!\n      </li>\n    </ul>\n  </article>\n  <label class="landing__canvas-size-wrapper">Set preferred canvas Size between 3 and 64:\n    <input class="landing__canvas-size" type="text" id="canvasSize" value="32">\n  </label>\n  <div class="btn start-btn">Lets Paint It!</div>\n  <article class="landing__about">\n      <span class="landing__link-to-app"><a class="landing__link" href="https://winsler.github.io/rss-pisk/">Wiskel Paint</a></span>\n      <span class="landing__author">by <a class="landing__link" href="https://github.com/Winsler/">Roman Makretski</a></span>\n      <a class="landing__link landing__link--telegram" href="https://telegram.me/share/url?url=https://winsler.github.io/rss-pisk/&text=Your Wiskel!">\n        <img src="'+n(23)+'" alt="share via telegram" title="Share via telegram">\n      </a>\n    </article>\n</section>'},function(t,e,n){"use strict";(function(t,e){var s,o=n(9),i=n.n(o);window.gifWorker=i.a,function(s){if("object"==typeof exports&&void 0!==t)t.exports=s();else if("function"==typeof define&&n(14))define([],s);else{("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).GIF=s()}}(function(){return function t(e,n,o){function i(r,c){if(!n[r]){if(!e[r]){if(!c&&("function"==typeof s&&s))return s(r,!0);if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[r]={exports:{}};e[r][0].call(h.exports,function(t){var n=e[r][1][t];return i(n||t)},h,h.exports,t,e,n,o)}return n[r].exports}for(var a="function"==typeof s&&s,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(t,e,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,n,s,r,c,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(a(n=this._events[t]))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(i(n))for(r=Array.prototype.slice.call(arguments,1),s=(l=n.slice()).length,c=0;c<s;c++)l[c].apply(this,r);return!0},s.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){if(!o(e))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(t,s),n||(n=!0,e.apply(this,arguments))}return s.listener=e,this.on(t,s),this},s.prototype.removeListener=function(t,e){var n,s,a,r;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(n=this._events[t]).length,s=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(r=a;r-- >0;)if(n[r]===e||n[r].listener&&n[r].listener===e){s=r;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(o(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var s,o,i,a,r;r=navigator.userAgent.toLowerCase(),a=navigator.platform.toLowerCase(),i="ie"===(s=r.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(o={name:"version"===s[1]?s[3]:s[1],version:i||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:r.match(/ip(?:ad|od|hone)/)?"ios":(r.match(/(?:webos|android)/)||a.match(/mac|win|linux/)||["other"])[0]}})[o.name]=!0,o[o.name+parseInt(o.version,10)]=!0,o.platform[o.platform.name]=!0,e.exports=o},{}],3:[function(t,e,n){var s,o,i,a={}.hasOwnProperty,r=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},c=[].slice;s=t("events").EventEmitter,i=t("./browser.coffee"),o=function(t){var e,n;function o(t){var n,s,o;for(s in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)o=e[s],null==(n=this.options)[s]&&(n[s]=o)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function s(){this.constructor=t}s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype}(o,s),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},o.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},o.prototype.setOptions=function(t){var e,n,s;for(e in n=[],t)a.call(t,e)&&(s=t[e],n.push(this.setOption(e,s)));return n},o.prototype.addFrame=function(t,e){var s,o;for(o in null==e&&(e={}),(s={}).transparent=this.options.transparent,n)s[o]=e[o]||n[o];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)s.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?s.data=this.getContextData(t):s.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?s.data=this.getImageData(t):s.image=t}return this.frames.push(s)},o.prototype.render=function(){var t,e,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,n;for(n=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)n.push(null);return n}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,n=e;0<=n?t<n:t>n;0<=n?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},o.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)this.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},o.prototype.spawnWorkers=function(){var t,e,n,s;return t=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var s=e=this.freeWorkers.length;e<=t?s<t:s>t;e<=t?s++:s--)n.push(s);return n}.apply(this).forEach((s=this,function(t){var e;return s.log("spawning worker "+t),(e=new window.gifWorker(s.options.workerScript)).onmessage=function(t){return s.activeWorkers.splice(s.activeWorkers.indexOf(e),1),s.freeWorkers.push(e),s.frameFinished(t.data)},s.freeWorkers.push(e)})),t},o.prototype.frameFinished=function(t){var e,n;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,n=this.freeWorkers.length;1<=n?e<n:e>n;1<=n?++e:--e)this.renderNextFrame();return r.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},o.prototype.finishRendering=function(){var t,e,n,s,o,i,a,r,c,l,h,d,p,u,m,v;for(r=0,o=0,c=(u=this.imageParts).length;o<c;o++)r+=((e=u[o]).data.length-1)*e.pageSize+e.cursor;for(r+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(r/1e3)+"kb"),t=new Uint8Array(r),d=0,i=0,l=(m=this.imageParts).length;i<l;i++)for(n=a=0,h=(v=(e=m[i]).data).length;a<h;n=++a)p=v[n],t.set(p,d),n===e.data.length-1?d+=e.cursor:d+=e.pageSize;return s=new Blob([t],{type:"image/gif"}),this.emit("finished",s,t)},o.prototype.renderNextFrame=function(){var t,e,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(e)},o.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},o.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},o.prototype.getTask=function(t){var e,n;if(n={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===i.name},null!=t.data)n.data=t.data;else if(null!=t.context)n.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");n.data=this.getImageData(t.image)}return n},o.prototype.log=function(){var t;if(t=1<=arguments.length?c.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},window.GIF=o,o}(),e.exports=o},{"./browser.coffee":2,events:1}]},{},[3])(3)})}).call(this,n(12)(t),n(13))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,n){var s=n(16),o=n(17);t.exports=function(t){var e=s.apply(s,o(t));return[e[0],parseInt(e[1],10),parseInt(e[2],10)]}},function(t,e){(function(){t.exports=function(t,e,n){var s,o,i,a,r,c;if(t/=255,e/=255,n/=255,o=0,c=0,i=((a=Math.max(t,e,n))+(r=Math.min(t,e,n)))/2,a===r)o=c=0;else{switch(s=a-r,c=i>.5?s/(2-a-r):s/(a+r),a){case t:o=(e-n)/s+(e<n?6:0);break;case e:o=(n-t)/s+2;break;case n:o=(t-e)/s+4}o/=6}return[o=Math.ceil(360*o),c=Math.ceil(100*c)+"%",i=Math.ceil(100*i)+"%"]}}).call(this)},function(t,e){t.exports=function(t){t.charAt&&"#"===t.charAt(0)&&(t=function(t){var e=t.split("");return e.shift(),e.join("")}(t)),3===t.length&&(t=function(t){return t.split("").reduce(function(t,e){return t.concat([e,e])},[]).join("")}(t));var e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}},function(t,e,n){var s=n(19);function o(t,e){return t>e?e:t}function i(t,e){return t<e?e:t}t.exports=function(t,e,n){return t=function(t){for(t=i(t=o(t,1e7),-1e7);t<0;)t+=360;for(;t>359;)t-=360;return t}(t),e=i(o(e,100),0),n=i(o(n,100),0),"#"+s(t,e/=100,n/=100).map(function(t){return(256+t).toString(16).substr(-2)}).join("")}},function(t,e){t.exports=function(t,e,n){if(null==t)return[0,0,0];var s,o,i,a=(1-Math.abs(2*n-1))*e,r=t/60,c=a*(1-Math.abs(r%2-1));0===(r=Math.floor(r))?(s=a,o=c,i=0):1===r?(s=c,o=a,i=0):2===r?(s=0,o=a,i=c):3===r?(s=0,o=c,i=a):4===r?(s=c,o=0,i=a):5===r&&(s=a,o=0,i=c);var l=n-a/2;return s+=l,o+=l,i+=l,[Math.round(255*s),Math.round(255*o),Math.round(255*i)]}},function(t,e,n){t.exports=n.p+"img/b7d1726ca8cc881215e9f9f1def9b95a.png"},function(t,e,n){t.exports=n.p+"img/f1e8900b31cad266696d3a07a8b6d213.png"},function(t,e,n){t.exports=n.p+"img/ea2f22639338d5d04df0f0cb7962f31d.png"},function(t,e,n){t.exports=n.p+"img/ce27469e5d9e9acb0e5e195abf8cb9db.png"},function(t,e,n){"use strict";n.r(e);n(25),n(27);var s=n(0),o=n.n(s);var i=class{constructor(t){const e=document.createElement("div");e.innerHTML=t,[this.node]=e.childNodes}render(t){t.appendChild(this.node)}};var a=class extends i{constructor(){super(o.a)}},r=(n(28),n(1)),c=n.n(r),l=(n(31),n(2)),h=n.n(l);var d=class extends i{constructor(){super(h.a),this.components={menu:this.node.querySelector(".shortcuts__menu"),closeBtn:this.node.querySelector(".shortcuts__close-btn"),restoreBtn:this.node.querySelector(".shortcuts__restore-btn")},this.state={activeShortcut:null}}show(){this.node.classList.add("shortcuts--visible")}hide(){this.node.classList.remove("shortcuts--visible")}activateShortKeyElement(t){this.state.activeShortcut=this.getTool(t),this.state.activeShortcut.classList.add("shortcuts__menu-shortcut--active")}disableShortKeyElement(){this.state.activeShortcut&&(this.state.activeShortcut.classList.remove("shortcuts__menu-shortcut--active"),this.state.activeShortcut=null)}setNewShortcutValues(t){Object.keys(t).forEach(e=>{this.getTool(e).textContent=t[e]||"none"})}setDefaultShortcutValues(t){t.forEach(t=>{this.getTool(t.name).textContent=String.fromCharCode(t.shortKeyCode)||"none"})}getTool(t){return this.components.menu.querySelector(`[data-type=${t.toLowerCase()}]`)}fillMenu(t){t.forEach(t=>{const e=document.createElement("li");let n=document.createElement("div");n.classList.add("palette__tool",`palette__tool--${t.name}`,"shortcuts__menu-img"),e.appendChild(n),(n=document.createElement("div")).textContent=String.fromCharCode(t.shortKeyCode),n.classList.add("shortcuts__menu-shortcut"),n.dataset.type=t.name.toLowerCase(),e.appendChild(n),n=document.createElement("div");const s=t.name.charAt(0).toUpperCase()+t.name.slice(1);n.textContent=s,n.classList.add("shortcuts__menu-tool-name"),e.appendChild(n),e.classList.add("shortcuts__menu-item"),this.components.menu.appendChild(e)})}};var p=class extends i{constructor(){super(c.a),this.components={palette:this.node.querySelector(".palette"),mainColorPicker:this.node.querySelector('[data-tool-type="mainColorPicker"]'),subColorPicker:this.node.querySelector('[data-tool-type="subColorPicker"]'),eraser:this.node.querySelector("[data-tool-type=eraser]"),pen:this.node.querySelector("[data-tool-type=pen]"),bucket:this.node.querySelector("[data-tool-type=bucket]"),rectangle:this.node.querySelector("[data-tool-type=rectangle]"),mirrorPen:this.node.querySelector("[data-tool-type=mirrorpen]"),pipette:this.node.querySelector("[data-tool-type=pipette]"),lighten:this.node.querySelector("[data-tool-type=lighten]"),sameColorPainter:this.node.querySelector("[data-tool-type=paintsamecolor]"),shortCutsSetter:this.node.querySelector("[data-tool-type=shortCutsSetter]"),swapColorTool:this.node.querySelector("[data-tool-type=swapcolors]"),dithering:this.node.querySelector("[data-tool-type=dithering]")}}render(t){super.render(t),this.components.shortcutMenu=new d,this.components.shortcutMenu.render(this.node.parentNode)}},u=(n(32),n(3)),m=n.n(u),v=(n(33),n(4)),f=n.n(v),g=n(5),w=n.n(g);var y=class extends i{constructor(t,e={parts:3,width:0,height:0},n){super(t),this.state={imageMatrix:n,layout:{defaultLayout:n?JSON.parse(JSON.stringify(n)):[[]],layouts:[n]}},this.components={canvasNode:this.node.querySelector("canvas")},this.options=e,this.options.maxWidth=600,this.node.querySelector("canvas").style.backgroundImage=`url(${w.a})`,this.components.canvasNode.linkToClass=this}render(t,e){return super.render(t),this.resizeCanvas(),this.paintImage(e),e}resizeCanvas(){const t=this.getCanvasSize(),e=this.components.canvasNode,n=Math.min(t.width,this.options.maxWidth);this.options.width=Math.floor(n/this.options.parts)*this.options.parts,this.options.height=this.options.width,this.components.canvasNode.style.height=`${this.options.height}px`,this.components.canvasNode.style.width=`${this.options.width}px`,e.width=this.options.width,e.height=this.options.height}paintImage(t){this.clear();const e=this.components.canvasNode.getContext("2d"),{parts:n}=this.options;for(let s=0;s<n;s+=1)for(let o=0;o<n;o+=1)e.fillStyle=t[s%n][[o%n]],e.fillRect(Math.round(this.options.width/n*s),Math.round(this.options.height/n*o),Math.round(this.options.width/n),Math.round(this.options.height/n))}strokePath(t,e,n,s){const o=t.slice(),i=e.slice(),a=this.state.imageMatrix;s||(s=n);let r=(o[0]+o[1])%2?n:s;function c(t,e){return t.every((t,n)=>t===e[n])}a[o[0]][o[1]]=r;let l=0;for(;!c(o,i);){const t=l%2==0?1:0;o[0]>i[0]&&t?o[0]-=1:o[0]<i[0]&&t?o[0]+=1:o[1]>i[1]&&!t?o[1]-=1:o[1]<i[1]&&!t&&(o[1]+=1),l+=1,r=(o[0]+o[1])%2?n:s,a[o[0]][o[1]]=r}this.paintImage(a)}getCanvasSize(){const t=window.getComputedStyle(this.components.canvasNode);return{width:parseFloat(t.width),height:parseFloat(t.height)}}paintState(){this.paintImage(this.state.imageMatrix)}paintPath(t,e,n){this.strokePath(t,e,n)}clear(){const t=this.components.canvasNode.getContext("2d"),e=this.getCanvasSize();t.clearRect(0,0,e.width,e.height)}clearPart({xPos:t,yPos:e}){const n=this.components.canvasNode.getContext("2d"),s=this.getCanvasSize();n.clearRect(Math.round(s.height/this.options.parts*t),Math.round(s.width/this.options.parts*e),Math.round(s.height/this.options.parts),Math.round(s.width/this.options.parts))}getRelativeCoords(t){const e=parseFloat(this.components.canvasNode.getBoundingClientRect().left),n=parseFloat(this.components.canvasNode.getBoundingClientRect().top);return{x:t.x-e,y:t.y-n}}setImage(t){this.state.imageMatrix=t}};var C=class extends y{constructor(t,e,n){super(f.a,n,e),this.components.popup={counter:this.node.querySelector(".frame__tool--counter"),bucket:this.node.querySelector(".frame__tool--bucket"),dublicate:this.node.querySelector(".frame__tool--dublicate")},this.components.frame=this.node.querySelector(".frame")}render(t){super.render(t,this.state.imageMatrix),this.components.canvasNode.linkToFrameClass=this;const e=getComputedStyle(this.components.frame);this.node.style.width=e.width,this.node.style.height=e.height}paintIamge(){super.paintImage(this.state.imageMatrix)}setIndex(t){this.components.popup.counter.querySelector("i").textContent=t}paintState(){this.paintIamge()}enable(){this.components.frame.classList.add("frame--active")}disable(){this.components.frame.classList.remove("frame--active")}};var S=class extends i{constructor(t){super(m.a),this.style=getComputedStyle(this.node),this.components={btn:this.node.querySelector(".frames-wrapper__btn"),frameList:this.node.querySelector(".frames-wrapper__list")},this.options={size:t}}addFrame(t,e){const n=new C(null,t,{parts:this.options.size,width:parseFloat(this.style.width),height:parseFloat(this.style.height)});n.setIndex(e);const s=document.createElement("li");s.setAttribute("draggable",!0),this.components.frameList.appendChild(s),n.render(s)}render(t,e){super.render(t),this.addFrame(e,1)}recalcIndexes(){this.components.frameList.querySelectorAll("li").forEach((t,e)=>{t.querySelector(".frame__tool--counter i").textContent=e+1})}getItemsLiveList(){return this.node.getElementsByTagName("li")}},b=(n(34),n(6)),_=n.n(b);var x=class extends y{constructor(t){super(_.a,{parts:t})}},k=(n(35),n(7)),L=n.n(k);var E=class extends y{constructor(t){super(L.a,{parts:t}),this.components.range=this.node.querySelector("input[type=range]"),this.components.fpsBox=this.node.querySelector(".fps"),this.components.fullScreenBtn=this.node.querySelector(".full-screen-btn"),this.components.gifBtn=this.node.querySelector(".get-gif-btn"),this.components.saveBtn=this.node.querySelector(".save-btn"),this.components.loadBtn=this.node.querySelector(".load-btn"),this.components.localSaveBtn=this.node.querySelector(".local-save-btn"),this.components.localLoadBtn=this.node.querySelector(".local-load-btn"),this.components.infoSize=this.node.querySelector(".info__size"),this.components.infoCoords=this.node.querySelector(".info__coords"),this.components.fileInput=this.node.querySelector(".file-input--hidden")}render(t,e,n){super.render(t,e),this.components.fpsBox.textContent=`${n} FPS`,this.components.range.value=n}},M=n(8),R=n.n(M);var F=class{constructor(t){const e=document.createElement("div");e.innerHTML=R.a,this.components={header:new a,tools:new p,frames:new S(t),canvas:new x(t),preview:new E(t),layot:e.childNodes[0]}}render(t,e){const{body:n}=document;this.components.header.render(n),n.appendChild(this.components.layot),this.components.tools.render(this.components.layot.querySelector(".tools")),this.components.frames.render(this.components.layot.querySelector(".frames"),t),this.components.canvas.render(this.components.layot.querySelector(".canvas"),t),this.components.preview.render(this.components.layot.querySelector(".preview"),t,e.defaultFPS)}paintImage(t){this.components.canvas.paintImage(t)}paintPath(t,e,n,s){this.components.canvas.strokePath(t,e,n,s)}resize(){const t=parseFloat(document.documentElement.clientHeight)-parseFloat(getComputedStyle(this.components.header.node).height)-parseFloat(getComputedStyle(document.querySelector(".layout")).paddingTop);this.components.canvas.node.style.height=`${t}px`}};var N=function(){const t=this.model.getBlackRect();this.view.render(t,this.options),this.state.activeRect=t;const e=this.view.components.frames.node.querySelector("canvas");this.state.activeFrame=e.linkToFrameClass,this.state.activeFrame.enable(),this.setToolsState(),this.view.components.canvas.state.imageMatrix=t};function T(t){let e=t;if("UL"===e.nodeName)return null;for(;"LI"!==e.nodeName;)e=e.parentNode;return e}var P={addFrame:function(){const t=this.model.getBlackRect();this.view.components.frames.addFrame(t,this.state.liveRects.length+1),this.view.components.canvas.paintImage(t),this.state.activeRect=t;const e=this.view.components.frames.node.querySelectorAll("canvas");this.state.activeFrame&&this.state.activeFrame.disable(),this.state.activeFrame=e[e.length-1].linkToFrameClass,this.state.activeFrame.enable(),this.view.components.canvas.state.imageMatrix=t,this.state.history.clearList()},frameActions:function(t){if("CANVAS"===t.target.nodeName){const e=t.target.linkToFrameClass.state.imageMatrix;this.state.activeRect=e,this.state.activeFrame&&this.state.activeFrame.disable(),this.state.activeFrame=t.target.linkToFrameClass,this.state.activeFrame.enable(),this.view.components.canvas.paintImage(e),this.view.components.canvas.state.imageMatrix=e,this.state.history.clearList()}else if(t.target.classList.contains("fa-copy")){let e=t.target;for(;"LI"!==e.nodeName;)e=e.parentNode;this.state.activeFrame.disable();const n=e.querySelector("canvas"),s=JSON.parse(JSON.stringify(n.linkToFrameClass.state.imageMatrix));this.view.components.frames.addFrame(s,this.state.liveRects.length+1),this.view.components.canvas.paintImage(s),this.state.activeRect=s,this.view.components.canvas.state.imageMatrix=s;const o=this.view.components.frames.node.querySelectorAll("canvas");this.state.activeFrame=o[o.length-1].linkToFrameClass,this.state.activeFrame.enable()}else if(t.target.classList.contains("fa-trash-alt")){let e=t.target;for(;"LI"!==e.nodeName;)e=e.parentNode;const n=e.parentNode.children;let s=0;const o=n.length;if(1===o)return;let i=n[s];for(;s<o&&i!==e;)i=n[s+=1];this.state.rects.splice(s,1),e.remove(),this.view.components.frames.recalcIndexes()}},drafFrame:function(t){const e=t.target;this.state.dragEl=e,this.state.dragPrevSib=e.nextSibling},dropFrame:function(t){const e=T(t.target);e&&e!==this.state.dragEl&&(e.firstElementChild.firstElementChild.classList.remove("frame--drop"),function(t,e){const n=t.parentNode;if(n!==e.parentNode)return;const s=t.nextSibling,o=e.nextSibling;(s===e&&!s||o===t&&!o)&&(n.firstNode===t?n.appendChild(e):n.appendChild(t)),s?n.insertBefore(e,s):n.appendChild(e),o?n.insertBefore(t,o):n.appendChild(t)}(e,this.state.dragEl),this.view.components.frames.recalcIndexes())},dragEnterFrame:function(t){const e=T(t.target);e&&e!==this.state.dragEl&&e.firstElementChild.firstElementChild.classList.add("frame--drop")},dragLeaveFrame:function(t){const e=T(t.target);e&&e!==this.state.dragEl&&e.firstElementChild.firstElementChild.classList.remove("frame--drop")}};n(11);var O={frame:P,preview:{changeFPS:function(t){const e=t.target.value;this.view.components.preview.components.fpsBox.textContent=`${e} FPS`,this.state.fps=e},fullScreenMode:function(){(Element.prototype.requestFullscreen||Element.prototype.webkitRequestFullscreen).call(this.view.components.preview.components.canvasNode)},getGif:function(){const t=this.getSlides(),e=128,n=32,s=new window.GIF({workers:5,quality:1,height:e,width:e,transparent:"#fff"});function o(t,s){!function(t){t.clearRect(0,0,e,e)}(t);for(let o=0;o<n;o+=1)for(let i=0;i<n;i+=1){let a=s[o%n][[i%n]];"#000"!==a&&"#000000"!==a||(a="#111111"),t.fillStyle=a,t.fillRect(Math.round(e/n*o),Math.round(e/n*i),Math.round(e/n),Math.round(e/n))}}const i=1e3/this.state.fps;t.forEach(t=>{const[n,a]=function(){const t=document.createElement("canvas");return t.width=e,t.height=e,[t.getContext("2d"),t]}();o(n,t),s.addFrame(a,{delay:i,copy:!0})}),s.on("finished",t=>{!function(t,e){const n=document.createElement("a");n.style="display: none",document.body.appendChild(n);const s=window.URL.createObjectURL(t);n.href=s,n.download=e,n.click(),window.URL.revokeObjectURL(s)}(t,"New Gif.gif")}),s.render()},saveSlides:function(){this.saveSlides()},loadSlides:function(){this.loadSlides()},localSave:function(){!function(t,e,n){const s=document.createElement("a"),o=new Blob([t],{type:n});s.href=URL.createObjectURL(o),s.download=e,s.click()}(JSON.stringify(this.getSlides()),"wiskel.json","application/json")},localLoad:function(){this.view.components.preview.components.fileInput.click()},loadFile:function(){const t=this.renderSlides.bind(this),e=this.view.components.preview.components.fileInput,n=new FileReader;n.onload=function(e){const n=JSON.parse(e.target.result);t(n)},n.readAsText(e.files[0])}}};var I=class{constructor(t,e=[],n=[],s=""){this.node=t,this.handlers=e,this.cursors=n,this.shortKeyCode=s?s.toUpperCase()[0].charCodeAt():s,this.subtool=null,this.name=t.dataset.toolType}addToolhandlers(){this.handlers.forEach(t=>{t.add()}),this.subtool&&this.addToolhandlers.call(this.subtool)}removeToolhandlers(){this.handlers.forEach(t=>{t.remove()}),this.subtool&&this.removeToolhandlers.call(this.subtool)}addhandler(t){return this.handlers.push(t),this}set subTool(t){return this.subtool=t,this}remove(){this.node.classList.remove("palette__tool--active"),this.removeToolhandlers(),this.cursors.forEach(t=>{t.target.style.cursor=""})}add(){this.node.classList.add("palette__tool--active"),this.addToolhandlers(),this.cursors.forEach(t=>{const e=t;e.target.style.cursor=e.cursor})}setShortKey(t=""){this.shortKeyCode=t.toUpperCase()[0].charCodeAt()}};var q=class{constructor(t,e,n,s={},o=[]){this.target=t,this.event=e,this.handler=n,this.options=s,this.subHandlers=o}add(){this.target.addEventListener(this.event,this.handler,this.options),this.subHandlers.forEach(t=>t.add())}remove(){this.target.removeEventListener(this.event,this.handler),this.subHandlers.forEach(t=>t.remove())}};var z=function(t,e,n){return new q(t,"mousedown",function(s){if(1===s.button)return;const o={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},i={x:Math.min(Math.max(0,s.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,s.clientY-o.y),o.yEnd)},a="rgba(0, 0, 0, 0)";let[r,c]=e(i,n.mainCanvasSize,n.parts);n.activeRect[r][c]=a,n.view.paintState(n.activeRect),n.activeFrame.paintState();const l=new q(t,"mousemove",function(t){const s={x:Math.min(Math.max(0,t.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,t.clientY-o.y),o.yEnd)};[r,c]=e(s,n.mainCanvasSize,n.parts),n.activeRect[r][c]=a,n.view.paintState(n.activeRect),n.activeFrame.paintState()}),h=new q(t,"mouseup",function(){l.remove()},{once:!0});l.add(),h.add()})};var B=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mouseup",function(s){if(1===s.button)return;const o={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},i={x:Math.min(Math.max(0,s.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,s.clientY-o.y),o.yEnd)},[a,r]=e(i,n.mainCanvasSize,n.parts),c=n.activeRect,l=c[a][r],h=s.button?n.subCurrColor:n.currColor;l!==h&&(function t(e=[]){if(!e.length)return null;let n=[];return e.forEach(t=>{t[0]>=0&&t[1]>=0&&c[t[0]][t[1]]===l&&(c[t[0]][t[1]]=h,n=n.concat(function(t,e){const n=[];for(let s=-1;s<2;s+=1)for(let o=-1;o<2;o+=1)Math.abs(s)!==Math.abs(o)&&e[t[0]+s]&&e[t[0]+s][t[1]+o]===l&&n.push([t[0]+s,t[1]+o]);return n}(t,c)))}),t(n)}([[a,r]]),n.view.paintImage(n.activeRect),n.activeFrame.paintState())})};var K=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mousedown",function(s){if(1===s.button)return;const o=t.linkToClass,i=o.getRelativeCoords({x:s.clientX,y:s.clientY}),a=s.button?n.subCurrColor:n.currColor;let r=null,c=JSON.parse(JSON.stringify(n.activeRect));const[l,h]=e(i,o.getCanvasSize(),n.parts);n.activeRect[l][h]=a,o.paintImage(n.activeRect);const d=new q(t,"mousemove",function(t){const s=o.getRelativeCoords({x:t.clientX,y:t.clientY});r=JSON.parse(JSON.stringify(n.activeRect));let[c,d]=e(s,o.getCanvasSize(),n.parts);if(c===l&&d===h)return;const p=Math.abs(s.x-i.x)/(s.x-i.x)||1,u=Math.abs(s.y-i.y)/(s.y-i.y)||1,m=Math.abs(c-l),v=Math.abs(d-h),f=Math.min(m,v);if(t.shiftKey&&(c=l+f*p,d=h+f*u),c!==l||d!==h){for(;c!==l;)r[c-=p][h]=a,r[c][d]=a;for([c,d]=e(s,o.getCanvasSize(),n.parts),t.shiftKey&&(c=l+f*p,d=h+f*u);d!==h;)d-=u,r[l][d]=a,r[c][d]=a;[c,d]=e(s,o.getCanvasSize(),n.parts),t.shiftKey&&(c=l+f*p,d=h+f*u),r[c][d]=a,o.paintImage(r)}});function p(t){n.activeFrame.setImage(t),n.view.components.canvas.state.imageMatrix=t,n.activeRect=t,n.view.paintImage(n.activeRect),o.paintImage(n.activeRect),n.activeFrame.paintState(),d.remove()}const u=new q(t,"mouseup",function(){p(JSON.parse(JSON.stringify(r))),c=JSON.parse(JSON.stringify(n.activeRect))},{once:!0}),m=new q(t,"mouseout",function(){d.remove(),u.remove(),p(c)},{once:!0});d.add(),u.add(),m.add()})};var J=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mouseup",function(s){if(1===s.button)return;const o=t.linkToClass,i=o.getRelativeCoords({x:s.clientX,y:s.clientY}),[a,r]=e(i,o.getCanvasSize(),n.parts),c=n.activeRect[a][r],l=s.button?n.subCurrColor:n.currColor;for(let t=0;t<n.parts;t+=1)for(let e=0;e<n.parts;e+=1)n.activeRect[t][e]===c&&(n.activeRect[t][e]=l);n.view.paintImage(n.activeRect),n.activeFrame.paintState()})};var D=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mousedown",function(s){if(1===s.button)return;const o={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},i={x:Math.min(Math.max(0,s.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,s.clientY-o.y),o.yEnd)},a=s.button?n.subCurrColor:n.currColor;function r(t){return t.ctrlKey?"horizontal":t.shiftKey?"both":"vertical"}function c(t,s,o="vertical"){const[i,r]=e(t,n.mainCanvasSize,n.parts),[c,l]=[n.parts-i,r],[h,d]=[i,n.parts-r],[p,u]=[n.parts-i,n.parts-r];let[m,v]=[i,r],[f,g]=[c,l],[w,y]=[h,d],[C,S]=[p,u];s&&([m,v]=e(s,n.mainCanvasSize,n.parts),[f,g]=[n.parts-m,v],[w,y]=[m,n.parts-v],[C,S]=[n.parts-m,n.parts-v]),n.view.paintPath([i,r],[m,v],a),"vertical"===o?n.view.paintPath([c,l],[f,g],a):"horizontal"===o?n.view.paintPath([h,d],[w,y],a):(n.view.paintPath([c,l],[f,g],a),n.view.paintPath([h,d],[w,y],a),n.view.paintPath([p,u],[C,S],a)),n.activeFrame.paintState()}c(i,i,r(s));let l=JSON.parse(JSON.stringify(i));const h=new q(t,"mousemove",function(t){const e={x:Math.min(Math.max(0,t.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,t.clientY-o.y),o.yEnd)},n=r(s);c(l,e,n),l=JSON.parse(JSON.stringify(e))}),d=new q(t,"mouseup",function(){h.remove()},{once:!0}),p=new q(t,"mouseout",function(){h.remove(),d.remove()},{once:!0});h.add(),d.add(),p.add()})};var A=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){function s(s){if(1===s.button)return;const o=t.linkToClass,i=o.getRelativeCoords({x:s.clientX,y:s.clientY}),[a,r]=e(i,o.getCanvasSize(),n.parts),c="rgba(0, 0, 0, 0)"===n.activeRect[a][r]?null:n.activeRect[a][r];c&&(s.button?2===s.button&&(n.subCurrColor=c,n.view.components.tools.components.subColorPicker.value=c):(n.currColor=c,n.view.components.tools.components.mainColorPicker.value=c))}const o=new q(t,"contextmenu",s);return new q(t,"click",s,{},[o])};const j=n(15),W=n(18);var Y={eraser:z,bucket:B,rectangle:K,paintSameColor:J,mirrorPen:D,pipette:A,lighten:function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mouseup",function(s){if(1===s.button)return;const o={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},i={x:Math.min(Math.max(0,s.clientX-o.x),o.xEnd),y:Math.min(Math.max(0,s.clientY-o.y),o.yEnd)},[a,r]=e(i,n.mainCanvasSize,n.parts),c=j(n.activeRect[a][r]);s.shiftKey?c[2]=Math.max(0,c[2]-10):c[2]=Math.min(100,c[2]+10),n.activeRect[a][r]=W(...c),n.view.paintImage(n.activeRect),n.activeFrame.paintState()})},pen:function({canvas:t,convetCoordsToCanvasRect:e,globalState:n},s=!1){return new q(t,"mousedown",function(o){if(o.preventDefault(),1===o.button)return;const i=t.linkToClass,a=i.getRelativeCoords({x:o.clientX,y:o.clientY});function r(t,i){const[a,r]=e(t,n.mainCanvasSize,n.parts);let[c,l]=[a,r];i&&([c,l]=e(i,n.mainCanvasSize,n.parts));const h=o.button?n.subCurrColor:n.currColor;n.view.paintPath([a,r],[c,l],s?"rgba(0, 0, 0, 0)":h),n.activeFrame.paintState()}r(a,a);let c=JSON.parse(JSON.stringify(a));const l=new q(t,"mousemove",function(t){const e=i.getRelativeCoords({x:t.clientX,y:t.clientY});r(c,e),c=JSON.parse(JSON.stringify(e))}),h=new q(t,"mouseup",function(){l.remove()},{once:!0}),d=new q(t,"mouseout",function(){l.remove(),h.remove()},{once:!0});l.add(),h.add(),d.add()})},toolSelection:function(t,e,n){return new q(t,"click",function(t){let s=t.target,o=s.getAttribute("data-tool-type");for(;!o;)o=(s=s.parentNode).getAttribute("data-tool-type");["mainColorPicker","subColorPicker","shortCutsSetter","swapcolors"].includes(o)||e(n[o])})},dithering:function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new q(t,"mousedown",function(s){if(s.preventDefault(),1===s.button)return;const o=t.linkToClass,i=o.getRelativeCoords({x:s.clientX,y:s.clientY});function a(t,s){const[o,i]=e(t,n.mainCanvasSize,n.parts);let[a,r]=[o,i];s&&([a,r]=e(s,n.mainCanvasSize,n.parts)),n.view.paintPath([o,i],[a,r],n.subCurrColor,n.currColor),n.activeFrame.paintState()}a(i,i);let r=JSON.parse(JSON.stringify(i));const c=new q(t,"mousemove",function(t){const e=o.getRelativeCoords({x:t.clientX,y:t.clientY});a(r,e),r=JSON.parse(JSON.stringify(e))}),l=new q(t,"mouseup",function(){c.remove()},{once:!0}),h=new q(t,"mouseout",function(){c.remove(),l.remove()},{once:!0});c.add(),l.add(),h.add()})}};var U=class{constructor(t){this.mainController=t,this.tools={},this.state={currentTool:null,keyDownHandler:null}}init(){const t={canvas:this.mainController.view.components.canvas.components.canvasNode,convetCoordsToCanvasRect:this.mainController.model.constructor.convetCoordsToCanvasRect.bind(this),globalState:this.mainController.state},{pen:e}=this.mainController.view.components.tools.components;this.tools.pen=new I(e,[Y.pen(t)],[],"P");const{eraser:n}=this.mainController.view.components.tools.components;this.tools.eraser=new I(n,[Y.pen(t,!0)],[],"E");const{bucket:s}=this.mainController.view.components.tools.components;this.tools.bucket=new I(s,[Y.bucket(t)],[],"B");const{rectangle:o}=this.mainController.view.components.tools.components;this.tools.rectangle=new I(o,[Y.rectangle(t,this.linkImage.bind(this))],[],"R");const{mirrorPen:i}=this.mainController.view.components.tools.components;this.tools.mirrorpen=new I(i,[Y.mirrorPen(t)],[],"M");const{pipette:a}=this.mainController.view.components.tools.components;this.tools.pipette=new I(a,[Y.pipette(t)],[],"I");const{lighten:r}=this.mainController.view.components.tools.components;this.tools.lighten=new I(r,[Y.lighten(t)],[],"L");const{sameColorPainter:c}=this.mainController.view.components.tools.components;this.tools.paintsamecolor=new I(c,[Y.paintSameColor(t)],[],"S");const{dithering:l}=this.mainController.view.components.tools.components;this.tools.dithering=new I(l,[Y.dithering(t)],[],"D");const{palette:h}=this.mainController.view.components.tools.components;Y.toolSelection(h,function(t){t===this.state.currentTool?(this.state.currentTool.remove(),this.state.currentTool=null):this.swapTool(t)}.bind(this),this.tools).add();const d=this.mainController.state,p=()=>{d.changeShortcutMode=!0,this.mainController.view.components.tools.components.shortcutMenu.show()},{mainController:u}=this,m=this,v=()=>{d.changeShortcutMode=!1,this.mainController.view.components.tools.components.shortcutMenu.hide()},{shortCutsSetter:f}=this.mainController.view.components.tools.components;f.addEventListener("click",()=>{p(),document.addEventListener("keydown",function t(e){27!==e.keyCode||u.state.editShortcutMode||(v(),document.removeEventListener("keydown",t))})}),this.mainController.view.components.tools.components.shortcutMenu.components.closeBtn.addEventListener("click",v),this.mainController.view.components.tools.components.shortcutMenu.components.restoreBtn.addEventListener("click",()=>{d.shortcuts.clear(),this.bindShortCuts(),d.view.components.tools.components.shortcutMenu.setDefaultShortcutValues(Object.values(this.tools))}),this.mainController.view.components.tools.components.shortcutMenu.components.menu.addEventListener("click",t=>{if(t.target.classList.contains("shortcuts__menu-shortcut")){u.state.editShortcutMode=!0,m.state.keyDownHandler&&(document.removeEventListener("keydown",m.state.keyDownHandler),m.state.keyDownHandler=null),this.mainController.view.components.tools.components.shortcutMenu.disableShortKeyElement();const n=t.target.parentNode.lastElementChild.textContent.toLowerCase();function e(t){if(27===t.keyCode)return d.view.components.tools.components.shortcutMenu.disableShortKeyElement(),document.removeEventListener("keydown",e),m.state.keyDownHandler=null,void(u.state.editShortcutMode=!1);const s=d.shortcuts.changeShortcut(n,t.keyCode,()=>{const{tools:t}=u.tools;m.swapTool(t[n])});d.view.components.tools.components.shortcutMenu.setNewShortcutValues(s),d.view.components.tools.components.shortcutMenu.disableShortKeyElement(),document.removeEventListener("keydown",e),m.state.keyDownHandler=null,u.state.editShortcutMode=!1}this.mainController.view.components.tools.components.shortcutMenu.activateShortKeyElement(n),document.addEventListener("keydown",e),m.state.keyDownHandler=e}}),this.bindShortCuts(),this.mainController.view.components.tools.components.shortcutMenu.fillMenu(Object.values(this.tools))}setTool(t){this.state.currentTool=t,this.state.currentTool.add()}removeTool(){this.state.currentTool&&(this.state.currentTool.remove(),this.state.currentTool=null)}swapTool(t){this.removeTool(),this.setTool(t)}linkImage(t){this.mainController.state.activeFrame.setImage(t),this.mainController.view.components.canvas.state.imageMatrix=t,this.mainController.state.activeRect=t}setShortKey(t){t.shortKeyCode&&this.mainController.state.shortcuts.setShortcut(t.shortKeyCode,t.name,()=>{this.swapTool(t)})}bindShortCuts(){Object.values(this.tools).forEach(t=>{this.setShortKey(t)})}};var H=class{constructor(t,e,n){this.value=JSON.parse(JSON.stringify(t)),this.previous=e||null,this.next=n||null}clearLinks(){this.previous=null,this.next=null}};var X=class{constructor(){this.state=null}append(t){const e=new H(t);return this.state&&(this.state.next&&this.state.next.clearLinks(),this.state.next=e,e.previous=this.state),this.state=e,e.value}previous(){if(!this.state)return;const t=this.state.previous;return t?(this.state=t,t.value):void 0}next(){if(!this.state)return;const t=this.state.next;return t?(this.state=t,t.value):void 0}clearList(){this.state=null}isEmpty(){return!this.state}};var $=class{constructor(){this.shorcuts={},this.toolToKeyCode={}}setShortcut(t,e,n){this.toolToKeyCode[e.toLowerCase()]=t,this.shorcuts[t]=n}changeShortcut(t,e,n){const s=t.toLowerCase(),o={};if(this.shorcuts[e]){const t=Object.entries(this.toolToKeyCode);let n=0;for(;t[n][1]!==e;)n+=1;const s=t[n][0];o[s]=null,delete this.shorcuts[this.toolToKeyCode[s]],delete this.toolToKeyCode[s]}const i=this.shorcuts[this.toolToKeyCode[s]]||n;return delete this.shorcuts[this.toolToKeyCode[s]],this.shorcuts[e]=i,delete this.toolToKeyCode[s],this.toolToKeyCode[s]=e,o[t]=String.fromCharCode(e),o}getTool(t){return this.shorcuts[t]}clear(){this.shorcuts={},this.toolToKeyCode={}}};var G=class{constructor(t){this.key=t,this.storage=localStorage}save(t){this.storage.setItem(this.key,t)}load(){return this.storage.getItem(this.key)}};var V=class{constructor(t,e,n){this.view=new t(n),this.model=new e(n),this.options={defaultFPS:5},this.state={parts:n,rects:[],activeRect:null,activeFrame:null,timer:null,fps:this.options.defaultFPS,mainCanvasSize:null,view:this.view,currColor:"#000",subCurrColor:"#000",liveRects:null,history:new X,shortcuts:new $,changeShortcutMode:!1,editShortcutMode:!1},this.tools=new U(this),this.slidesStorage=new G("wiskelSlides")}init(){N.call(this);const t=function(){const t=this;let e=0;const n=t.view.components.preview;!function s(){const{fps:o}=t.state,i=1e3/o,a=Date.now();if(a-e>=i){e=a;const s=t.state.liveRects.getNext().querySelector("canvas").linkToFrameClass.state.imageMatrix;s&&(n.clear(),t.view.components.preview.paintImage(s))}requestAnimationFrame(s)}()}.bind(this);this.view.components.frames.components.btn.addEventListener("click",O.frame.addFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("click",O.frame.frameActions.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragstart",O.frame.drafFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragover",t=>t.preventDefault()),this.view.components.frames.components.frameList.addEventListener("dragenter",O.frame.dragEnterFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragleave",O.frame.dragLeaveFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("drop",O.frame.dropFrame.bind(this)),this.view.components.preview.components.range.addEventListener("input",O.preview.changeFPS.bind(this)),this.view.components.preview.components.fullScreenBtn.addEventListener("click",O.preview.fullScreenMode.bind(this)),this.view.components.preview.components.gifBtn.addEventListener("click",O.preview.getGif.bind(this)),this.view.components.preview.components.saveBtn.addEventListener("click",O.preview.saveSlides.bind(this)),this.view.components.preview.components.loadBtn.addEventListener("click",O.preview.loadSlides.bind(this)),this.view.components.preview.components.localSaveBtn.addEventListener("click",O.preview.localSave.bind(this)),this.view.components.preview.components.localLoadBtn.addEventListener("click",O.preview.localLoad.bind(this)),this.view.components.preview.components.fileInput.addEventListener("change",O.preview.loadFile.bind(this)),this.view.components.preview.components.infoSize.textContent=`${this.state.parts} x ${this.state.parts}`,this.view.components.canvas.components.canvasNode.addEventListener("mousemove",t=>{const e=this.view.components.canvas.components.canvasNode.linkToClass,[n,s]=this.model.constructor.convetCoordsToCanvasRect({x:t.clientX,y:t.clientY},e.getCanvasSize(),this.state.parts,this.view.components.canvas.components.canvasNode);this.view.components.preview.components.infoCoords.textContent=`${s+1} - ${n+1}`}),this.view.components.canvas.components.canvasNode.addEventListener("click",t=>t.preventDefault()),this.view.components.canvas.components.canvasNode.addEventListener("mousedown",t=>t.preventDefault()),this.view.components.canvas.components.canvasNode.addEventListener("contextmenu",t=>t.preventDefault());const{mainColorPicker:e,subColorPicker:n,swapColorTool:s}=this.view.components.tools.components;e.addEventListener("input",()=>{this.state.currColor=e.value}),n.addEventListener("input",()=>{this.state.subCurrColor=n.value}),s.addEventListener("click",()=>{this.swapColors()});const o=this.view.components.canvas.getCanvasSize();this.state.mainCanvasSize=o,this.tools.init(),this.view.resize(),this.view.components.canvas.components.canvasNode.addEventListener("mousedown",()=>{this.state.history.isEmpty()&&this.tools.state.currentTool&&this.state.history.append(JSON.parse(JSON.stringify(this.state.activeRect)))}),this.view.components.canvas.components.canvasNode.addEventListener("click",()=>{this.tools.state.currentTool&&this.state.history.append(JSON.parse(JSON.stringify(this.state.activeRect)))}),this.view.components.canvas.components.canvasNode.addEventListener("contextmenu",()=>{this.tools.state.currentTool&&this.state.history.append(JSON.parse(JSON.stringify(this.state.activeRect)))});const i={27:"ESC",90:"Z",89:"Y",32:"SPACE"},a=t=>{if(t){const e=JSON.parse(JSON.stringify(t));this.view.components.canvas.state.imageMatrix=e,this.state.activeRect=e,this.state.activeFrame.state.imageMatrix=e,this.view.components.canvas.paintState(e),this.state.activeFrame.paintState(e)}};document.body.addEventListener("keydown",t=>{if(!this.state.changeShortcutMode)if("ESC"===i[t.keyCode]&&this.tools.state.currentTool)this.tools.state.currentTool.remove();else if("Z"===i[t.keyCode]&&t.ctrlKey){const t=this.state.history.previous();a(t)}else if("Y"===i[t.keyCode]&&t.ctrlKey){const t=this.state.history.next();a(t)}else"SPACE"===i[t.keyCode]&&t.ctrlKey?(t.preventDefault(),this.swapColors()):this.state.shortcuts.shorcuts[t.keyCode]&&!t.ctrlKey&&this.state.shortcuts.shorcuts[t.keyCode]()}),this.state.liveRects=this.view.components.frames.getItemsLiveList(),this.state.liveRects.getNext=function(){let t=0;return function(){return t>=this.length-1?t=0:t+=1,this[t]}}(),t()}setToolsState(){return this}getSlides(){return Array.from(this.state.liveRects).map(t=>t.querySelector("canvas").linkToFrameClass.state.imageMatrix)}saveSlides(){const t=JSON.stringify(this.getSlides());this.slidesStorage.save(t)}loadSlides(){const t=JSON.parse(this.slidesStorage.load());this.renderSlides(t)}renderSlides(t){if(!t||!t.length)return;this.clearSlides(),t.forEach(t=>{this.view.components.frames.addFrame(t,this.state.liveRects.length+1)}),this.state.history.clearList();const e=t[t.length-1],n=this.view.components.frames.components.frameList.lastElementChild.querySelector("canvas").linkToClass;this.state.activeRect=e,this.view.components.canvas.paintImage(this.state.activeRect),this.view.components.canvas.state.imageMatrix=this.state.activeRect,this.state.activeFrame=n,this.state.activeFrame.enable()}clearSlides(){Array.from(this.state.liveRects).forEach(t=>t.remove())}swapColors(){const t=this.state.currColor;this.state.currColor=this.state.subCurrColor,this.state.subCurrColor=t,this.view.components.tools.components.mainColorPicker.value=this.state.currColor,this.view.components.tools.components.subColorPicker.value=this.state.subCurrColor}};class Z{constructor(t){this.options={parts:t}}static getRandomHexColor(){return`#${Math.floor(16777215*Math.random()).toString(16)}`}getRandomRect(){const t=this.options.parts;return new Array(t).fill(new Array(t).fill(0)).map(t=>t.map(()=>Z.getRandomHexColor()))}getBlackRect(){const t=this.options.parts;return new Array(t).fill(new Array(t).fill(0)).map(t=>t.map(()=>"rgba(0, 0, 0, 0)"))}static convetCoordsToCanvasRect({x:t,y:e},n,s,o){const i=o?o.offsetLeft:0,a=o?o.offsetTop:0,r=n.width/s,c=Math.trunc((t-i)/r),l=n.height/s;return[c,Math.trunc((e-a)/l)]}}var Q=Z;var tt=class{constructor(t,e){this.view=new t,this.api=e,this.defaultCanvasSize=32}init(){const{body:t}=document;this.view.render(t);const e=()=>{this.view.components.startBtn.removeEventListener("click",e);let t=parseInt(this.view.components.canvasSize.value,10)||this.defaultCanvasSize;t<3?t=3:t>64&&(t=64),document.body.innerHTML="";const{Controller:n,View:s,Model:o}=this.api;new n(s,o,t).init()};this.view.components.startBtn.addEventListener("click",e)}},et=(n(36),n(10)),nt=n.n(et);var st={View:F,Controller:V,StartPageController:tt,StartPageView:class extends i{constructor(){super(nt.a),this.components={startBtn:this.node.querySelector(".start-btn"),canvasSize:this.node.querySelector("#canvasSize")}}},Model:Q};const{StartPageController:ot,StartPageView:it}=st;new ot(it,st).init()},function(t,e){},,function(t,e){},function(t,e){},,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){}]);