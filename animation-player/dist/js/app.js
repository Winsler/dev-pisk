!function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e){t.exports='<header class="head">\r\n  <h1 class="head__title">Wiskel</h1>\r\n  <div class="handle handle--head-handle">\r\n    <div class="handle__point"></div>\r\n  </div>\r\n</header>'},function(t,e){t.exports='<aside class="tools">\n  <div class="palette">\n    <div class="palette__tool palette__tool--pen" data-tool-type="pen" title="Pen"></div>\n    <div class="palette__tool palette__tool--eraser" data-tool-type="eraser" title="Eraser"></div>\n    <div class="palette__tool palette__tool--bucket" data-tool-type="bucket" title="Bucket"></div>\n    <div class="palette__tool palette__tool--rectangle" data-tool-type="rectangle" title="Rectangle&#13Kepp shift: 1 to 1 ratio"></div>\n    <div class="palette__tool palette__tool--paintSameColor" data-tool-type="paintSameColor" title="Paint all pixeles of the same color"></div>\n    <div class="palette__tool palette__tool--mirrorPen" data-tool-type="mirrorPen" title="Vertical Mirror Pen"></div>\n    <div class="palette__tool palette__tool--pipette" data-tool-type="pipette" title="Color Picker"></div>\n    <div class="palette__tool palette__tool--lighten" data-tool-type="lighten" title="Lighten"></div>\n    <input type="color" class="color-picker" data-tool-type="mainColorPicker">\n    <input type="color" class="color-picker" data-tool-type="subColorPicker">\n    <div class="palette__tool palette__tool--shortCuts" data-tool-type="shortCutsSetter" title="Keyboard Shortcuts"></div>\n  </div>\n</aside>'},function(t,e){t.exports='<article class="shortcuts">\n  <header class="shortcuts__title">\n    <span>Keyboard shortcuts</span>\n    <div class="shortcuts__close-btn">X</div>\n  </header>\n  <ul class="shortcuts__menu"></ul>\n  <footer class="shortcuts__footer">\n    <div class="shortcuts__restore-btn">Restore default shortcuts</div>\n  </footer>\n</article>'},function(t,e){t.exports='<div class="frames-wrapper">\r\n  <ul class="frames-wrapper__list"></ul>\r\n  <div class="btn frames-wrapper__btn">\r\n    <div class="frames-wrapper__btn-icon"></div>\r\n    <div>Add Frame</div>\r\n  </div>\r\n</div>'},function(t,e){t.exports='<div class="frame-wrapper">\n  <canvas class="frame"></canvas>\n  <div class="frame__tool frame__tool--counter"><i class="frame__tool-content">1</i></div>\n  <div class="frame__tool frame__tool--bucket"><i class="fas fa-trash-alt frame__tool-content"></i></div>\n  <div class="frame__tool frame__tool--dublicate"><i class="fas fa-copy frame__tool-content"></i></div>\n</div>'},function(t,e,n){t.exports=n.p+"img/ff229da200bda0d612e9ad5620765bec.png"},function(t,e){t.exports='<div class="main-canvas-wrapper">\r\n  <canvas class="main-canvas"></canvas>\r\n</div>'},function(t,e){t.exports='<div class="preview-wrapper">\r\n  <canvas></canvas>\r\n  <div class="range-wrapper">\r\n    <input type="range" min="1" max="24" step="1" value="0">\r\n    <span class="fps"></span>\r\n  </div>\r\n  <div class="btn full-screen-btn">Full Screen Mode</div>\r\n  <div class="btn get-gif-btn">Download as GIF</div>\r\n</div>'},function(t,e){t.exports='<main class="layout">\r\n  <div class="tools"></div>\r\n  <div class="frames"></div>\r\n  <div class="canvas"></div>\r\n  <div class="preview"></div>\r\n</main>'},function(t,e,n){var o=n(10),s=n(11);t.exports=function(t){var e=o.apply(o,s(t));return[e[0],parseInt(e[1],10),parseInt(e[2],10)]}},function(t,e){(function(){t.exports=function(t,e,n){var o,s,a,i,r,c;if(t/=255,e/=255,n/=255,s=0,c=0,a=((i=Math.max(t,e,n))+(r=Math.min(t,e,n)))/2,i===r)s=c=0;else{switch(o=i-r,c=a>.5?o/(2-i-r):o/(i+r),i){case t:s=(e-n)/o+(e<n?6:0);break;case e:s=(n-t)/o+2;break;case n:s=(t-e)/o+4}s/=6}return[s=Math.ceil(360*s),c=Math.ceil(100*c)+"%",a=Math.ceil(100*a)+"%"]}}).call(this)},function(t,e){t.exports=function(t){t.charAt&&"#"===t.charAt(0)&&(t=function(t){var e=t.split("");return e.shift(),e.join("")}(t)),3===t.length&&(t=function(t){return t.split("").reduce(function(t,e){return t.concat([e,e])},[]).join("")}(t));var e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}},function(t,e,n){var o=n(13);function s(t,e){return t>e?e:t}function a(t,e){return t<e?e:t}t.exports=function(t,e,n){return t=function(t){for(t=a(t=s(t,1e7),-1e7);t<0;)t+=360;for(;t>359;)t-=360;return t}(t),e=a(s(e,100),0),n=a(s(n,100),0),"#"+o(t,e/=100,n/=100).map(function(t){return(256+t).toString(16).substr(-2)}).join("")}},function(t,e){t.exports=function(t,e,n){if(null==t)return[0,0,0];var o,s,a,i=(1-Math.abs(2*n-1))*e,r=t/60,c=i*(1-Math.abs(r%2-1));0===(r=Math.floor(r))?(o=i,s=c,a=0):1===r?(o=c,s=i,a=0):2===r?(o=0,s=i,a=c):3===r?(o=0,s=c,a=i):4===r?(o=c,s=0,a=i):5===r&&(o=i,s=0,a=c);var l=n-i/2;return o+=l,s+=l,a+=l,[Math.round(255*o),Math.round(255*s),Math.round(255*a)]}},function(t,e,n){"use strict";n.r(e);n(15),n(17);var o=n(0),s=n.n(o);var a=class{constructor(t){const e=document.createElement("div");e.innerHTML=t,[this.node]=e.childNodes}render(t){t.appendChild(this.node)}};var i=class extends a{constructor(){super(s.a)}},r=(n(18),n(1)),c=n.n(r),l=(n(21),n(2)),h=n.n(l);var d=class extends a{constructor(){super(h.a),this.components={menu:this.node.querySelector(".shortcuts__menu"),closeBtn:this.node.querySelector(".shortcuts__close-btn")},this.state={activeShortcut:null}}show(){this.node.classList.add("shortcuts--visible")}hide(){this.node.classList.remove("shortcuts--visible")}activateShortKeyElement(t){this.state.activeShortcut=this.getTool(t),this.state.activeShortcut.classList.add("shortcuts__menu-shortcut--active")}disableShortKeyElement(){this.state.activeShortcut&&(this.state.activeShortcut.classList.remove("shortcuts__menu-shortcut--active"),this.state.activeShortcut=null)}setNewShortcutValues(t){Object.keys(t).forEach(e=>{this.getTool(e).textContent=t[e]||"none"})}getTool(t){return this.components.menu.querySelector(`[data-type=${t.toLowerCase()}]`)}fillMenu(t){t.forEach(t=>{const e=document.createElement("li");let n=document.createElement("div");n.classList.add("palette__tool",`palette__tool--${t.name}`,"shortcuts__menu-img"),e.appendChild(n),(n=document.createElement("div")).textContent=String.fromCharCode(t.shortKeyCode),n.classList.add("shortcuts__menu-shortcut"),n.dataset.type=t.name.toLowerCase(),e.appendChild(n),n=document.createElement("div");const o=t.name.charAt(0).toUpperCase()+t.name.slice(1);n.textContent=o,n.classList.add("shortcuts__menu-tool-name"),e.appendChild(n),e.classList.add("shortcuts__menu-item"),this.components.menu.appendChild(e)})}};var u=class extends a{constructor(){super(c.a),this.components={palette:this.node.querySelector(".palette"),mainColorPicker:this.node.querySelector('[data-tool-type="mainColorPicker"]'),subColorPicker:this.node.querySelector('[data-tool-type="subColorPicker"]'),eraser:this.node.querySelector("[data-tool-type=eraser]"),pen:this.node.querySelector("[data-tool-type=pen]"),bucket:this.node.querySelector("[data-tool-type=bucket]"),rectangle:this.node.querySelector("[data-tool-type=rectangle]"),mirrorPen:this.node.querySelector("[data-tool-type=mirrorPen]"),pipette:this.node.querySelector("[data-tool-type=pipette]"),lighten:this.node.querySelector("[data-tool-type=lighten]"),sameColorPainter:this.node.querySelector("[data-tool-type=paintSameColor]"),shortCutsSetter:this.node.querySelector("[data-tool-type=shortCutsSetter]")}}render(t){super.render(t),this.components.shortcutMenu=new d,this.components.shortcutMenu.render(this.node.parentNode)}},p=(n(22),n(3)),m=n.n(p),v=(n(23),n(4)),f=n.n(v),g=n(5),y=n.n(g);var C=class extends a{constructor(t,e={parts:3,width:0,height:0},n){super(t),this.state={imageMatrix:n,layout:{defaultLayout:n?JSON.parse(JSON.stringify(n)):[[]],layouts:[n]}},this.components={canvasNode:this.node.querySelector("canvas")},this.options=e,this.options.maxWidth=600,this.node.querySelector("canvas").style.backgroundImage=`url(${y.a})`,this.components.canvasNode.linkToClass=this}render(t,e){return super.render(t),this.resizeCanvas(),this.paintImage(e),e}resizeCanvas(){const t=this.getCanvasSize(),e=this.components.canvasNode,n=Math.min(t.width,this.options.maxWidth);this.options.width=Math.floor(n/this.options.parts)*this.options.parts,this.options.height=this.options.width,this.components.canvasNode.style.height=`${this.options.height}px`,this.components.canvasNode.style.width=`${this.options.width}px`,e.width=this.options.width,e.height=this.options.height}paintImage(t){this.clear();const e=this.components.canvasNode.getContext("2d"),{parts:n}=this.options;for(let o=0;o<n;o+=1)for(let s=0;s<n;s+=1)e.fillStyle=t[o%n][[s%n]],e.fillRect(Math.round(this.options.width/n*o),Math.round(this.options.height/n*s),Math.round(this.options.width/n),Math.round(this.options.height/n))}strokePath(t,e,n){const o=t.slice(),s=e.slice(),a=this.state.imageMatrix;function i(t,e){return t.every((t,n)=>t===e[n])}a[o[0]][o[1]]=n;let r=0;for(;!i(o,s);){const t=r%2==0?1:0;o[0]>s[0]&&t?o[0]-=1:o[0]<s[0]&&t?o[0]+=1:o[1]>s[1]&&!t?o[1]-=1:o[1]<s[1]&&!t&&(o[1]+=1),r+=1,a[o[0]][o[1]]=n}this.paintImage(a)}getCanvasSize(){const t=window.getComputedStyle(this.components.canvasNode);return{width:parseFloat(t.width),height:parseFloat(t.height)}}paintState(){this.paintImage(this.state.imageMatrix)}paintPath(t,e,n){this.strokePath(t,e,n)}clear(){const t=this.components.canvasNode.getContext("2d"),e=this.getCanvasSize();t.clearRect(0,0,e.width,e.height)}clearPart({xPos:t,yPos:e}){const n=this.components.canvasNode.getContext("2d"),o=this.getCanvasSize();n.clearRect(Math.round(o.height/this.options.parts*t),Math.round(o.width/this.options.parts*e),Math.round(o.height/this.options.parts),Math.round(o.width/this.options.parts))}getRelativeCoords(t){const e=parseFloat(this.components.canvasNode.getBoundingClientRect().left),n=parseFloat(this.components.canvasNode.getBoundingClientRect().top);return{x:t.x-e,y:t.y-n}}setImage(t){this.state.imageMatrix=t}};var w=class extends C{constructor(t,e,n){super(f.a,n,e),this.components.popup={counter:this.node.querySelector(".frame__tool--counter"),bucket:this.node.querySelector(".frame__tool--bucket"),dublicate:this.node.querySelector(".frame__tool--dublicate")},this.components.frame=this.node.querySelector(".frame")}render(t){super.render(t,this.state.imageMatrix),this.components.canvasNode.linkToFrameClass=this;const e=getComputedStyle(this.components.frame);this.node.style.width=e.width,this.node.style.height=e.height}paintIamge(){super.paintImage(this.state.imageMatrix)}setIndex(t){this.components.popup.counter.querySelector("i").textContent=t}paintState(){this.paintIamge()}enable(){this.components.frame.classList.add("frame--active")}disable(){this.components.frame.classList.remove("frame--active")}};var S=class extends a{constructor(t){super(m.a),this.style=getComputedStyle(this.node),this.components={btn:this.node.querySelector(".frames-wrapper__btn"),frameList:this.node.querySelector(".frames-wrapper__list")},this.options={size:t}}addFrame(t,e){const n=new w(null,t,{parts:this.options.size,width:parseFloat(this.style.width),height:parseFloat(this.style.height)});n.setIndex(e);const o=document.createElement("li");o.setAttribute("draggable",!0),this.components.frameList.appendChild(o),n.render(o)}render(t,e){super.render(t),this.addFrame(e,1)}recalcIndexes(){this.components.frameList.querySelectorAll("li").forEach((t,e)=>{t.querySelector(".frame__tool--counter i").textContent=e+1})}getItemsLiveList(){return this.node.getElementsByTagName("li")}},x=(n(24),n(6)),b=n.n(x);var _=class extends C{constructor(t){super(b.a,{parts:t})}},M=(n(25),n(7)),E=n.n(M);var k=class extends C{constructor(t){super(E.a,{parts:t}),this.components.range=this.node.querySelector("input[type=range]"),this.components.fpsBox=this.node.querySelector(".fps"),this.components.fullScreenBtn=this.node.querySelector(".full-screen-btn"),this.components.gifBtn=this.node.querySelector(".get-gif-btn")}render(t,e,n){super.render(t,e),this.components.fpsBox.textContent=`${n} FPS`,this.components.range.value=n}},R=n(8),L=n.n(R);var F=class{constructor(t){const e=document.createElement("div");e.innerHTML=L.a,this.components={header:new i,tools:new u,frames:new S(t),canvas:new _(t),preview:new k(t),layot:e.childNodes[0]}}render(t,e){const{body:n}=document;this.components.header.render(n),n.appendChild(this.components.layot),this.components.tools.render(this.components.layot.querySelector(".tools")),this.components.frames.render(this.components.layot.querySelector(".frames"),t),this.components.canvas.render(this.components.layot.querySelector(".canvas"),t),this.components.preview.render(this.components.layot.querySelector(".preview"),t,e.defaultFPS)}paintImage(t){this.components.canvas.paintImage(t)}paintPath(t,e,n){this.components.canvas.strokePath(t,e,n)}resize(){const t=parseFloat(document.documentElement.clientHeight)-parseFloat(getComputedStyle(this.components.header.node).height)-parseFloat(getComputedStyle(document.querySelector(".layout")).paddingTop);this.components.canvas.node.style.height=`${t}px`}};var T=function(){const t=this.model.getBlackRect();this.view.render(t,this.options),this.state.activeRect=t;const e=this.view.components.frames.node.querySelector("canvas");this.state.activeFrame=e.linkToFrameClass,this.state.activeFrame.enable(),this.setToolsState(),this.view.components.canvas.state.imageMatrix=t};function N(t){let e=t;if("UL"===e.nodeName)return null;for(;"LI"!==e.nodeName;)e=e.parentNode;return e}var P={frame:{addFrame:function(){const t=this.model.getBlackRect();this.view.components.frames.addFrame(t,this.state.liveRects.length+1),this.view.components.canvas.paintImage(t),this.state.activeRect=t;const e=this.view.components.frames.node.querySelectorAll("canvas");this.state.activeFrame&&this.state.activeFrame.disable(),this.state.activeFrame=e[e.length-1].linkToFrameClass,this.state.activeFrame.enable(),this.view.components.canvas.state.imageMatrix=t,this.state.history.clearList()},frameActions:function(t){if("CANVAS"===t.target.nodeName){const e=t.target.linkToFrameClass.state.imageMatrix;this.state.activeRect=e,this.state.activeFrame&&this.state.activeFrame.disable(),this.state.activeFrame=t.target.linkToFrameClass,this.state.activeFrame.enable(),this.view.components.canvas.paintImage(e),this.view.components.canvas.state.imageMatrix=e,this.state.history.clearList()}else if(t.target.classList.contains("fa-copy")){let e=t.target;for(;"LI"!==e.nodeName;)e=e.parentNode;this.state.activeFrame.disable();const n=e.querySelector("canvas"),o=JSON.parse(JSON.stringify(n.linkToFrameClass.state.imageMatrix));this.view.components.frames.addFrame(o,this.state.rects.length),this.view.components.canvas.paintImage(o),this.state.activeRect=o,this.view.components.canvas.state.imageMatrix=o;const s=this.view.components.frames.node.querySelectorAll("canvas");this.state.activeFrame=s[s.length-1].linkToFrameClass,this.state.activeFrame.enable()}else if(t.target.classList.contains("fa-trash-alt")){let e=t.target;for(;"LI"!==e.nodeName;)e=e.parentNode;const n=e.parentNode.children;let o=0;const s=n.length;if(1===s)return;let a=n[o];for(;o<s&&a!==e;)a=n[o+=1];this.state.rects.splice(o,1),e.remove(),this.view.components.frames.recalcIndexes()}},drafFrame:function(t){const e=t.target;this.state.dragEl=e,this.state.dragPrevSib=e.nextSibling},dropFrame:function(t){const e=N(t.target);e&&e!==this.state.dragEl&&(e.firstElementChild.firstElementChild.classList.remove("frame--drop"),function(t,e){const n=t.parentNode;if(n!==e.parentNode)return;const o=t.nextSibling,s=e.nextSibling;(o===e&&!o||s===t&&!s)&&(n.firstNode===t?n.appendChild(e):n.appendChild(t)),o?n.insertBefore(e,o):n.appendChild(e),s?n.insertBefore(t,s):n.appendChild(t)}(e,this.state.dragEl),this.view.components.frames.recalcIndexes())},dragEnterFrame:function(t){const e=N(t.target);e&&e!==this.state.dragEl&&e.firstElementChild.firstElementChild.classList.add("frame--drop")},dragLeaveFrame:function(t){const e=N(t.target);e&&e!==this.state.dragEl&&e.firstElementChild.firstElementChild.classList.remove("frame--drop")}},preview:{changeFPS:function(t){const e=t.target.value;this.view.components.preview.components.fpsBox.textContent=`${e} FPS`,this.state.fps=e},fullScreenMode:function(){this.view.components.preview.components.canvasNode.requestFullscreen()},getGif:function(){const t=Array.from(this.state.liveRects).map(t=>t.querySelector("canvas").linkToFrameClass.state.colors),e=128,n=32,o=new window.GIF({workers:5,quality:1,height:e,width:e,transparent:"#fff"});function s(t,o){!function(t){t.clearRect(0,0,e,e)}(t);for(let s=0;s<n;s+=1)for(let a=0;a<n;a+=1){let i=o[s%n][[a%n]];"#000"!==i&&"#000000"!==i||(i="#111111",window.console.log("swapped")),t.fillStyle=i,t.fillRect(Math.round(e/n*s),Math.round(e/n*a),Math.round(e/n),Math.round(e/n))}}const a=1e3/this.state.fps;t.forEach(t=>{window.console.log(t);const[n,i]=function(){const t=document.createElement("canvas");return t.width=e,t.height=e,[t.getContext("2d"),t]}();s(n,t),o.addFrame(i,{delay:a,copy:!0})}),o.on("finished",t=>{!function(t,e){const n=document.createElement("a");n.style="display: none",document.body.appendChild(n);const o=window.URL.createObjectURL(t);n.href=o,n.download=e,n.click(),window.URL.revokeObjectURL(o)}(t,"New Gif.gif")}),o.render()}}};var q=class{constructor(t,e=[],n=[],o=""){this.node=t,this.handlers=e,this.cursors=n,this.shortKeyCode=o?o.toUpperCase()[0].charCodeAt():o,this.subtool=null,this.name=t.dataset.toolType}addToolhandlers(){this.handlers.forEach(t=>{t.add()}),this.subtool&&this.addToolhandlers.call(this.subtool)}removeToolhandlers(){this.handlers.forEach(t=>{t.remove()}),this.subtool&&this.removeToolhandlers.call(this.subtool)}addhandler(t){return this.handlers.push(t),this}set subTool(t){return this.subtool=t,this}remove(){this.node.classList.remove("palette__tool--active"),this.removeToolhandlers(),this.cursors.forEach(t=>{t.target.style.cursor=""})}add(){this.node.classList.add("palette__tool--active"),this.addToolhandlers(),this.cursors.forEach(t=>{const e=t;e.target.style.cursor=e.cursor})}setShortKey(t=""){this.shortKeyCode=t.toUpperCase()[0].charCodeAt()}};var I=class{constructor(t,e,n,o={},s=[]){this.target=t,this.event=e,this.handler=n,this.options=o,this.subHandlers=s}add(){this.target.addEventListener(this.event,this.handler,this.options)}remove(){this.target.removeEventListener(this.event,this.handler),this.subHandlers.forEach(t=>t.remove())}};var O=function(t,e,n){return new I(t,"mousedown",function(o){const s={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},a={x:Math.min(Math.max(0,o.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,o.clientY-s.y),s.yEnd)},i="rgba(0, 0, 0, 0)";let[r,c]=e(a,n.mainCanvasSize,n.parts);n.activeRect[r][c]=i,n.view.paintState(n.activeRect),n.activeFrame.paintState();const l=new I(t,"mousemove",function(t){const o={x:Math.min(Math.max(0,t.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,t.clientY-s.y),s.yEnd)};[r,c]=e(o,n.mainCanvasSize,n.parts),n.activeRect[r][c]=i,n.view.paintState(n.activeRect),n.activeFrame.paintState()}),h=new I(t,"mouseup",function(){l.remove()},{once:!0});l.add(),h.add()})};var B=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"click",function(o){const s={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},a={x:Math.min(Math.max(0,o.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,o.clientY-s.y),s.yEnd)},[i,r]=e(a,n.mainCanvasSize,n.parts),c=n.activeRect,l=c[i][r];!function t(e=[]){if(!e.length)return null;let o=[];return e.forEach(t=>{t[0]>=0&&t[1]>=0&&c[t[0]][t[1]]===l&&(c[t[0]][t[1]]=n.currColor,o=o.concat(function(t,e){const n=[];for(let o=-1;o<2;o+=1)for(let s=-1;s<2;s+=1)Math.abs(o)!==Math.abs(s)&&e[t[0]+o]&&e[t[0]+o][t[1]+s]===l&&n.push([t[0]+o,t[1]+s]);return n}(t,c)))}),t(o)}([[i,r]]),n.view.paintImage(n.activeRect),n.activeFrame.paintState()})};var K=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"mousedown",function(o){const s=t.linkToClass,a=s.getRelativeCoords({x:o.clientX,y:o.clientY});let i=null;const[r,c]=e(a,s.getCanvasSize(),n.parts);n.activeRect[r][c]=n.currColor,s.paintImage(n.activeRect);const l=new I(t,"mousemove",function(t){const o=s.getRelativeCoords({x:t.clientX,y:t.clientY});i=JSON.parse(JSON.stringify(n.activeRect));let[l,h]=e(o,s.getCanvasSize(),n.parts);if(l===r&&h===c)return;const d=Math.abs(o.x-a.x)/(o.x-a.x)||1,u=Math.abs(o.y-a.y)/(o.y-a.y)||1,p=Math.abs(l-r),m=Math.abs(h-c),v=Math.min(p,m);if(t.shiftKey&&(l=r+v*d,h=c+v*u),l!==r||h!==c){for(;l!==r;)i[l-=d][c]=n.currColor,i[l][h]=n.currColor;for([l,h]=e(o,s.getCanvasSize(),n.parts),t.shiftKey&&(l=r+v*d,h=c+v*u);h!==c;)h-=u,i[r][h]=n.currColor,i[l][h]=n.currColor;[l,h]=e(o,s.getCanvasSize(),n.parts),t.shiftKey&&(l=r+v*d,h=c+v*u),i[l][h]=n.currColor,s.paintImage(i)}}),h=new I(t,"mouseup",function(){const t=JSON.parse(JSON.stringify(i));n.activeFrame.setImage(t),n.view.components.canvas.state.imageMatrix=t,n.activeRect=t,n.view.paintImage(n.activeRect),s.paintImage(n.activeRect),n.activeFrame.paintState(),l.remove()},{once:!0});l.add(),h.add()})};var z=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"click",function(o){const s=t.linkToClass,a=s.getRelativeCoords({x:o.clientX,y:o.clientY}),[i,r]=e(a,s.getCanvasSize(),n.parts),c=n.activeRect[i][r];for(let t=0;t<n.parts;t+=1)for(let e=0;e<n.parts;e+=1)n.activeRect[t][e]===c&&(n.activeRect[t][e]=n.currColor);n.view.paintImage(n.activeRect),n.activeFrame.paintState()})};var J=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"mousedown",function(o){const s={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},a={x:Math.min(Math.max(0,o.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,o.clientY-s.y),s.yEnd)};function i(t){return t.ctrlKey?"horizontal":t.shiftKey?"both":"vertical"}function r(t,o,s="vertical"){const[a,i]=e(t,n.mainCanvasSize,n.parts),[r,c]=[n.parts-a,i],[l,h]=[a,n.parts-i],[d,u]=[n.parts-a,n.parts-i];let[p,m]=[a,i],[v,f]=[r,c],[g,y]=[l,h],[C,w]=[d,u];o&&([p,m]=e(o,n.mainCanvasSize,n.parts),[v,f]=[n.parts-p,m],[g,y]=[p,n.parts-m],[C,w]=[n.parts-p,n.parts-m]);const S=n.currColor;n.view.paintPath([a,i],[p,m],S),"vertical"===s?n.view.paintPath([r,c],[v,f],S):"horizontal"===s?n.view.paintPath([l,h],[g,y],S):(n.view.paintPath([r,c],[v,f],S),n.view.paintPath([l,h],[g,y],S),n.view.paintPath([d,u],[C,w],S)),n.activeFrame.paintState()}r(a,a,i(o));let c=JSON.parse(JSON.stringify(a));const l=new I(t,"mousemove",function(t){const e={x:Math.min(Math.max(0,t.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,t.clientY-s.y),s.yEnd)},n=i(o);r(c,e,n),c=JSON.parse(JSON.stringify(e))}),h=new I(t,"mouseup",function(){l.remove()},{once:!0}),d=new I(t,"mouseout",function(){l.remove(),h.remove()},{once:!0});l.add(),h.add(),d.add()})};var A=function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"click",function(o){const s=t.linkToClass,a=s.getRelativeCoords({x:o.clientX,y:o.clientY}),[i,r]=e(a,s.getCanvasSize(),n.parts),c="rgba(0, 0, 0, 0)"===n.activeRect[i][r]?null:n.activeRect[i][r];c&&(n.currColor=c,n.view.components.tools.components.mainColorPicker.value=c)})};const j=n(9),H=n(12);var Y={eraser:O,bucket:B,rectangle:K,paintSameColor:z,mirrorPen:J,pipette:A,lighten:function({canvas:t,convetCoordsToCanvasRect:e,globalState:n}){return new I(t,"click",function(o){const s={x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top,xEnd:t.getBoundingClientRect().right,yEnd:t.getBoundingClientRect().bottom},a={x:Math.min(Math.max(0,o.clientX-s.x),s.xEnd),y:Math.min(Math.max(0,o.clientY-s.y),s.yEnd)},[i,r]=e(a,n.mainCanvasSize,n.parts),c=j(n.activeRect[i][r]);o.shiftKey?c[2]=Math.max(0,c[2]-10):c[2]=Math.min(100,c[2]+10),n.activeRect[i][r]=H(...c),n.view.paintImage(n.activeRect),n.activeFrame.paintState()})},pen:function({canvas:t,convetCoordsToCanvasRect:e,globalState:n},o=!1){return new I(t,"mousedown",function(s){const a=t.linkToClass,i=a.getRelativeCoords({x:s.clientX,y:s.clientY});function r(t,s){const[a,i]=e(t,n.mainCanvasSize,n.parts);let[r,c]=[a,i];s&&([r,c]=e(s,n.mainCanvasSize,n.parts));const l=o?"rgba(0, 0, 0, 0)":n.currColor;n.view.paintPath([a,i],[r,c],l),n.activeFrame.paintState()}r(i,i);let c=JSON.parse(JSON.stringify(i));const l=new I(t,"mousemove",function(t){const e=a.getRelativeCoords({x:t.clientX,y:t.clientY});r(c,e),c=JSON.parse(JSON.stringify(e))}),h=new I(t,"mouseup",function(){l.remove()},{once:!0}),d=new I(t,"mouseout",function(){l.remove(),h.remove()},{once:!0});l.add(),h.add(),d.add()})},toolSelection:function(t,e,n){return new I(t,"click",function(t){let o=t.target,s=o.getAttribute("data-tool-type");for(;!s;)s=(o=o.parentNode).getAttribute("data-tool-type");["mainColorPicker","subColorPicker","shortCutsSetter"].includes(s)||e(n[s])})}};var X=class{constructor(t){this.mainController=t,this.tools={},this.state={currentTool:null,keyDownHandler:null}}init(){const t={canvas:this.mainController.view.components.canvas.components.canvasNode,convetCoordsToCanvasRect:this.mainController.model.constructor.convetCoordsToCanvasRect.bind(this),globalState:this.mainController.state},{pen:e}=this.mainController.view.components.tools.components;this.tools.pen=new q(e,[Y.pen(t)],[],"P");const{eraser:n}=this.mainController.view.components.tools.components;this.tools.eraser=new q(n,[Y.pen(t,!0)],[],"E");const{bucket:o}=this.mainController.view.components.tools.components;this.tools.bucket=new q(o,[Y.bucket(t)],[],"B");const{rectangle:s}=this.mainController.view.components.tools.components;this.tools.rectangle=new q(s,[Y.rectangle(t,this.linkImage.bind(this))],[],"R");const{mirrorPen:a}=this.mainController.view.components.tools.components;this.tools.mirrorpen=new q(a,[Y.mirrorPen(t)],[],"M");const{pipette:i}=this.mainController.view.components.tools.components;this.tools.pipette=new q(i,[Y.pipette(t)],[],"I");const{lighten:r}=this.mainController.view.components.tools.components;this.tools.lighten=new q(r,[Y.lighten(t)],[],"L");const{sameColorPainter:c}=this.mainController.view.components.tools.components;this.tools.paintsamecolor=new q(c,[Y.paintSameColor(t)],[],"S");const{palette:l}=this.mainController.view.components.tools.components;Y.toolSelection(l,this.swapTool.bind(this),this.tools).add();const h=this.mainController.state,d=()=>{h.changeShortcutMode=!0,this.mainController.view.components.tools.components.shortcutMenu.show()},{mainController:u}=this,p=this,m=()=>{h.changeShortcutMode=!1,this.mainController.view.components.tools.components.shortcutMenu.hide()},{shortCutsSetter:v}=this.mainController.view.components.tools.components;v.addEventListener("click",()=>{d(),document.addEventListener("keydown",function t(e){27!==e.keyCode||u.state.editShortcutMode||(m(),document.removeEventListener("keydown",t))})}),this.mainController.view.components.tools.components.shortcutMenu.components.closeBtn.addEventListener("click",m),this.mainController.view.components.tools.components.shortcutMenu.components.menu.addEventListener("click",t=>{if(t.target.classList.contains("shortcuts__menu-shortcut")){u.state.editShortcutMode=!0,p.state.keyDownHandler&&(document.removeEventListener("keydown",p.state.keyDownHandler),p.state.keyDownHandler=null),this.mainController.view.components.tools.components.shortcutMenu.disableShortKeyElement();const n=t.target.parentNode.lastElementChild.textContent.toLowerCase();function e(t){if(27===t.keyCode)return h.view.components.tools.components.shortcutMenu.disableShortKeyElement(),document.removeEventListener("keydown",e),p.state.keyDownHandler=null,void(u.state.editShortcutMode=!1);const o=h.shortcuts.changeShortcut(n,t.keyCode,()=>{const{tools:t}=u.tools;p.swapTool(t[n])});h.view.components.tools.components.shortcutMenu.setNewShortcutValues(o),h.view.components.tools.components.shortcutMenu.disableShortKeyElement(),document.removeEventListener("keydown",e),p.state.keyDownHandler=null,u.state.editShortcutMode=!1}this.mainController.view.components.tools.components.shortcutMenu.activateShortKeyElement(n),document.addEventListener("keydown",e),p.state.keyDownHandler=e}}),this.buildShortCuts(),this.mainController.view.components.tools.components.shortcutMenu.fillMenu(Object.values(this.tools))}setTool(t){this.state.currentTool=t,this.state.currentTool.add()}removeTool(){this.state.currentTool&&(this.state.currentTool.remove(),this.state.currentTool=null)}swapTool(t){this.removeTool(),this.setTool(t)}linkImage(t){this.mainController.state.activeFrame.setImage(t),this.mainController.view.components.canvas.state.imageMatrix=t,this.mainController.state.activeRect=t}setShortKey(t){t.shortKeyCode&&this.mainController.state.shortcuts.setShortcut([t.shortKeyCode],t.name,()=>{this.swapTool(t)})}buildShortCuts(){Object.values(this.tools).forEach(t=>{this.setShortKey(t)})}};var D=class{constructor(t,e,n){this.value=JSON.parse(JSON.stringify(t)),this.previous=e||null,this.next=n||null}clearLinks(){this.previous=null,this.next=null}};var $=class{constructor(){this.state=null}append(t){const e=new D(t);this.state&&(this.state.next&&this.state.next.clearLinks(),this.state.next=e,e.previous=this.state),this.state=e}previous(){if(!this.state)return;const t=this.state.previous;return t?(this.state=t,t.value):void 0}next(){if(!this.state)return;const t=this.state.next;return t?(this.state=t,t.value):void 0}clearList(){this.state=null}isEmpty(){return!!this.state}};var U=class{constructor(){this.shorcuts={},this.toolToKeyCode={}}setShortcut(t,e,n){this.toolToKeyCode[e.toLowerCase()]=t,this.shorcuts[t]=n}changeShortcut(t,e,n){const o=t.toLowerCase(),s={};if(this.shorcuts[e]){const t=Object.entries(this.toolToKeyCode);let n=0;for(;t[n][1]!==e;)n+=1;const o=t[n][0];s[o]=null,delete this.shorcuts[this.toolToKeyCode[o]],delete this.toolToKeyCode[o]}const a=this.shorcuts[this.toolToKeyCode[o]]||n;return delete this.shorcuts[this.toolToKeyCode[o]],this.shorcuts[e]=a,delete this.toolToKeyCode[o],this.toolToKeyCode[o]=e,s[t]=String.fromCharCode(e),s}getTool(t){return this.shorcuts[t]}};class V{constructor(t){this.options={parts:t}}static getRandomHexColor(){return`#${Math.floor(16777215*Math.random()).toString(16)}`}getRandomRect(){const t=this.options.parts;return new Array(t).fill(new Array(t).fill(0)).map(t=>t.map(()=>V.getRandomHexColor()))}getBlackRect(){const t=this.options.parts;return new Array(t).fill(new Array(t).fill(0)).map(t=>t.map(()=>"rgba(0, 0, 0, 0)"))}static convetCoordsToCanvasRect({x:t,y:e},n,o){const s=n.width/o,a=Math.trunc(t/s),i=n.height/o;return[a,Math.trunc(e/i)]}}var G={View:F,Controller:class{constructor(t,e,n){this.view=new t(n),this.model=new e(n),this.options={defaultFPS:5},this.state={parts:n,rects:[],activeRect:null,activeFrame:null,timer:null,fps:this.options.defaultFPS,mainCanvasSize:null,view:this.view,currColor:"#000",subCurrColor:"#000",liveRects:this.view.components.frames.getItemsLiveList(),history:new $,shortcuts:new U,changeShortcutMode:!1,editShortcutMode:!1},this.tools=new X(this)}init(){T.call(this);const t=function(){const t=this;let e=0;const n=t.view.components.preview;!function o(){const{fps:s}=t.state,a=1e3/s,i=Date.now();if(i-e>=a){e=i;const o=t.state.liveRects.getNext().querySelector("canvas").linkToFrameClass.state.imageMatrix;o&&(n.clear(),t.view.components.preview.paintImage(o))}requestAnimationFrame(o)}()}.bind(this);this.view.components.frames.components.btn.addEventListener("click",P.frame.addFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("click",P.frame.frameActions.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragstart",P.frame.drafFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragover",t=>t.preventDefault()),this.view.components.frames.components.frameList.addEventListener("dragenter",P.frame.dragEnterFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("dragleave",P.frame.dragLeaveFrame.bind(this)),this.view.components.frames.components.frameList.addEventListener("drop",P.frame.dropFrame.bind(this)),this.view.components.preview.components.range.addEventListener("input",P.preview.changeFPS.bind(this)),this.view.components.preview.components.fullScreenBtn.addEventListener("click",P.preview.fullScreenMode.bind(this)),this.view.components.preview.components.gifBtn.addEventListener("click",P.preview.getGif.bind(this));const{mainColorPicker:e,subColorPicker:n}=this.view.components.tools.components;e.addEventListener("input",()=>{this.state.currColor=e.value}),n.addEventListener("input",()=>{this.state.subCurrColor=n.value}),this.state.liveRects.getNext=function(){let t=0;return function(){return t>=this.length-1?t=0:t+=1,this[t]}}(),t();const o=this.view.components.canvas.getCanvasSize();this.state.mainCanvasSize=o,this.tools.init(),this.view.resize(),this.view.components.canvas.components.canvasNode.addEventListener("mousedown",()=>{this.state.history.isEmpty()||this.state.history.append(JSON.parse(JSON.stringify(this.state.activeRect)))}),this.view.components.canvas.components.canvasNode.addEventListener("mouseup",()=>{this.state.history.append(JSON.parse(JSON.stringify(this.state.activeRect)))});const s={27:"ESC",90:"Z",89:"Y"},a=t=>{if(t){const e=JSON.parse(JSON.stringify(t));this.view.components.canvas.state.imageMatrix=e,this.state.activeRect=e,this.state.activeFrame.state.imageMatrix=e,this.view.components.canvas.paintState(e),this.state.activeFrame.paintState(e)}};document.body.addEventListener("keydown",t=>{if(!this.state.changeShortcutMode)if("ESC"===s[t.keyCode]&&this.tools.state.currentTool)this.tools.state.currentTool.remove();else if("Z"===s[t.keyCode]&&t.ctrlKey){const t=this.state.history.previous();a(t)}else if("Y"===s[t.keyCode]&&t.ctrlKey){const t=this.state.history.next();a(t)}else this.state.shortcuts.shorcuts[t.keyCode]&&this.state.shortcuts.shorcuts[t.keyCode]()})}setToolsState(){return this}},Model:V};const{Controller:W,View:Z,Model:Q}=G;new W(Z,Q,32).init()},function(t,e){},,function(t,e){},function(t,e){},,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){}]);